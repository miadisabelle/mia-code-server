# Prompt Decomposition

## Directions

- üåÖ **EAST** ‚Äî VISION: What is being asked?
- üî• **SOUTH** ‚Äî ANALYSIS: What needs to be learned?
- üåä **WEST** ‚Äî VALIDATION: What needs reflection?
- ‚ùÑÔ∏è **NORTH** ‚Äî ACTION: What executes the cycle?

## Original Prompt

> ## Session: Mino √ó Workspace Lifecycle √ó LangGraph Agent Sessions
> 
> ### Context
> mia-code-server has a Workspace Lifecycle Engine (src/node/mia/workspace-lifecycle/) that manages creative development sessions through Task‚ÜíSpec‚ÜíPlan‚ÜíCode‚ÜíPR phases, with STC bridge integration tracking structural tension from 1.0‚Üí0.0. Separately, mino-mcp provides session chronicle capabilities: gist registration, perspective generation (mia_miette, tushell_journal, the_council), note-taking, and summarization of agent sessions.
> 
> ### Vision
> Connect mino's session memory layer to the workspace lifecycle engine so that:
> 
> 1. **Session Chronicle as Workspace Memory** ‚Äî When a workspace lifecycle session completes (tension reaches 0), mino automatically captures it as a gist-backed chronicle with all three perspectives generated. The workspace's `NarrativeArc.beats[]` become the raw material for Tushell's journal. The `WorkspaceSpecification.currentReality` ‚Üí `desiredOutcome` transition becomes Mia's structural analysis.
> 
> 2. **PDE Decompositions as Launchable Agent Sessions** ‚Äî Each `.pde/` file represents a potential agent session. A LangGraph supervisor node could read `.pde/` decompositions, spawn worker agents for each action, and orchestrate their execution. The mino session export captures what each agent actually did ‚Äî creating a feedback loop: decompose ‚Üí launch ‚Üí chronicle ‚Üí learn.
> 
> 3. **Ava as LangGraph Supervisor** ‚Äî Using ava-langgraphjs architecture, Ava acts as the orchestrator-worker pattern: reading `.pde/` decompositions as graph definitions, spawning specialized agents (code-writer, spec-reviewer, test-runner) as worker nodes, with conditional edges based on workspace phase transitions. Each worker's session gets captured via mino, creating a multi-agent chronicle.
> 
> 4. **Rispec: `12-session-chronicle-integration.spec.md`** ‚Äî New mia-server-core rispec formalizing mino as the session memory backend. Components: WorkspaceChronicleEmitter (listens to workspace events, triggers mino gist creation), PerspectiveGenerator (auto-generates perspectives from workspace narrative arc), SessionResumeLoader (when resuming a workspace, loads prior mino chronicles as context).
> 
> 5. **Rispec: `06-langgraph-agent-orchestration.spec.md`** ‚Äî New pde-engine rispec defining how PDE decompositions become LangGraph graph definitions. Components: PDEGraphCompiler (transforms decomposition JSON into LangGraph StateGraph), AgentSessionBridge (each graph node's execution captured as mino session), TensionFeedbackEdge (conditional edges that check workspace tension level to decide next action).
> 
> ### Desired Outcome
> A coherent architecture where decomposition‚Üíexecution‚Üíchronicle forms a self-reinforcing cycle: every agent session is planned (PDE), executed (LangGraph), chronicled (mino), and learnable (perspectives feed future decompositions).
> 
> ### Additional Context ‚Äî Ava's LangGraph Architecture
> Ava lives as a self-directing agent with tools (GitHub, Drive, MCP, Hugging Face). LangGraph adds stateful memory + graph-based flow control: persistent state nodes, conditional edges, cycles for uncertainty. The orchestrator-worker pattern (Fire Keeper directing helpers) maps directly to how PDE decompositions could spawn specialized agents. The evaluator-optimizer pattern (generate‚Üíevaluate‚Üírefine‚Üíloop) IS Fritz's structural tension resolution made computational.

## Primary Intent

**Action:** architect
**Target:** mino √ó workspace-lifecycle √ó langgraph integration layer
**Urgency:** session
**Confidence:** 92%

## Secondary Intents

1. **create** ‚Äî rispec 12-session-chronicle-integration.spec.md ‚Äî mino as workspace memory backend _(explicit)_
2. **create** ‚Äî rispec 06-langgraph-agent-orchestration.spec.md ‚Äî PDE decompositions as LangGraph graph definitions _(explicit)_
3. **implement** ‚Äî WorkspaceChronicleEmitter ‚Äî event listener that triggers mino gist creation on workspace completion (tension=0) _(explicit)_
   - depends on: rispec 12-session-chronicle-integration.spec.md
4. **implement** ‚Äî PerspectiveGenerator ‚Äî auto-generates mia_miette/tushell/council perspectives from NarrativeArc.beats[] _(explicit)_
   - depends on: WorkspaceChronicleEmitter
5. **implement** ‚Äî SessionResumeLoader ‚Äî loads prior mino chronicles as context when resuming a workspace _(explicit)_
   - depends on: WorkspaceChronicleEmitter
6. **design** ‚Äî PDEGraphCompiler ‚Äî transforms .pde/ decomposition JSON into LangGraph StateGraph definitions _(explicit)_
   - depends on: rispec 06-langgraph-agent-orchestration.spec.md
7. **design** ‚Äî AgentSessionBridge ‚Äî each LangGraph node execution captured as mino session export _(explicit)_
   - depends on: PDEGraphCompiler
8. **design** ‚Äî TensionFeedbackEdge ‚Äî conditional LangGraph edges that check workspace tensionLevel to route next action _(explicit)_
   - depends on: PDEGraphCompiler
9. **connect** ‚Äî Ava (ava-langgraphjs) as orchestrator-worker supervisor reading .pde/ decompositions _(explicit)_
   - depends on: PDEGraphCompiler
10. **establish** ‚Äî decompose‚Üíexecute‚Üíchronicle‚Üílearn feedback loop as the core operational cycle _(implicit)_
   - depends on: AgentSessionBridge
11. **recognize** ‚Äî Fritz's evaluator-optimizer pattern (generate‚Üíevaluate‚Üírefine‚Üíloop) IS structural tension resolution made computational via LangGraph cycles _(implicit)_
12. **prepare** ‚Äî context seeds for Ava's LangGraph mastery session ‚Äî supervisor vs swarm vs pure agent positioning _(implicit)_

## Context Requirements

### Files Needed
- src/node/mia/workspace-lifecycle/engine.ts
- src/node/mia/workspace-lifecycle/types.ts
- src/node/mia/workspace-lifecycle/stc-bridge.ts
- rispecs/mia-server-core/05-session-persistence.spec.md
- rispecs/codevops-platform/07-workspace-lifecycle.spec.md
- rispecs/pde-engine/05-steerable-decomposition.spec.md
- .pde/776c1096-9f77-416b-ab15-e4ced300c5aa.md

### Tools Required
- mcp-pde (decomposition engine)
- mcp-mino (session chronicle, perspectives, gist management)
- medicine-wheel (STC charts, narrative beats, ceremony logging)
- ava-langgraphjs (LangGraph supervisor architecture)
- gh CLI (gist creation, issue tracking)

### Assumptions
- mino API is stable and can be called programmatically from workspace lifecycle engine events
- mino's generate_perspective supports local mode for code-grounded perspectives
- LangGraph StateGraph can be constructed dynamically from JSON definitions
- ava-langgraphjs repo will serve as the LangGraph execution runtime
- .pde/ decompositions contain enough structure to map to graph nodes + edges
- workspace lifecycle engine's event emitter pattern is extensible for chronicle hooks

## Four Directions Analysis

### üåÖ EAST ‚Äî VISION

- Vision: decompose‚Üíexecute‚Üíchronicle‚Üílearn as the self-reinforcing creative cycle [95%]
- Vision: .pde/ files ARE launchable agent session blueprints, not just documentation [90%]
- Vision: Ava as Fire Keeper ‚Äî orchestrator reading decomposition graphs, spawning specialized workers [75%]

### üî• SOUTH ‚Äî ANALYSIS

- Analyze: how workspace engine events map to mino gist creation triggers [90%]
- Analyze: NarrativeArc.beats[] as raw material for auto-perspective generation [88%]
- Research: LangGraph StateGraph construction from dynamic JSON (ava-langgraphjs patterns) [72%] _(implicit)_
- Study: evaluator-optimizer pattern as Fritz's structural tension in computational form [85%] _(implicit)_

### üåä WEST ‚Äî VALIDATION

- Validate: mino API can handle programmatic gist creation from engine events [85%] _(implicit)_
- Validate: perspectives auto-generated from code context match hand-crafted quality [80%] _(implicit)_
- Test: .pde/ JSON structure contains sufficient information for LangGraph graph compilation [75%] _(implicit)_

### ‚ùÑÔ∏è NORTH ‚Äî ACTION

- Write rispec 12-session-chronicle-integration.spec.md [95%]
- Write rispec 06-langgraph-agent-orchestration.spec.md [90%]
- Build WorkspaceChronicleEmitter subscribing to engine events [85%]
- Build PerspectiveGenerator mapping NarrativeArc to mino perspective content [82%]
- Design PDEGraphCompiler interface for .pde/ ‚Üí LangGraph StateGraph [75%]

## Action Stack

- [ ] Read existing rispecs (05-session-persistence, 07-workspace-lifecycle, 05-steerable-decomposition) to understand current spec landscape
- [ ] Read workspace lifecycle engine.ts event emission pattern to understand hook points
- [ ] Write rispec 12-session-chronicle-integration.spec.md ‚Äî WorkspaceChronicleEmitter, PerspectiveGenerator, SessionResumeLoader (depends on: read existing rispecs)
- [ ] Write rispec 06-langgraph-agent-orchestration.spec.md ‚Äî PDEGraphCompiler, AgentSessionBridge, TensionFeedbackEdge (depends on: read existing rispecs)
- [ ] Implement WorkspaceChronicleEmitter ‚Äî subscribe to engine.on(), trigger mino gist creation on workspace:completed (depends on: rispec 12)
- [ ] Implement PerspectiveGenerator ‚Äî transform NarrativeArc.beats[] into mia_miette/tushell/council perspectives via mino local mode (depends on: WorkspaceChronicleEmitter)
- [ ] Implement SessionResumeLoader ‚Äî on workspace resume, fetch mino chronicles and inject as context (depends on: WorkspaceChronicleEmitter)
- [ ] Validate mino API integration ‚Äî test programmatic gist creation from engine events (depends on: WorkspaceChronicleEmitter)
- [ ] Design PDEGraphCompiler interface ‚Äî .pde/ JSON ‚Üí LangGraph StateGraph node/edge mapping (depends on: rispec 06)
- [ ] Research ava-langgraphjs supervisor patterns ‚Äî how Ava reads graph definitions and spawns workers
- [ ] Design TensionFeedbackEdge ‚Äî conditional edges checking tensionLevel to route agent flow (depends on: PDEGraphCompiler interface)
- [ ] Validate: auto-generated perspectives from code context match quality of hand-crafted ones (depends on: PerspectiveGenerator)
- [ ] Seed Ava session context ‚Äî supervisor vs swarm positioning, Medicine Wheel mapping to LangGraph state

## Ambiguity Flags

- **"Whether mino's API supports webhook/event-driven gist creation or requires polling"**
  - Suggestion: Check mino-mcp tool list for event subscription capabilities vs request-response only
- **"How LangGraph StateGraph handles dynamic graph construction from JSON at runtime"**
  - Suggestion: Review ava-langgraphjs codebase for dynamic graph patterns vs static definitions
- **"Whether .pde/ decomposition JSON has enough structural information for meaningful graph edges (dependencies vs action ordering)"**
  - Suggestion: Compare .pde/ dependency field with LangGraph conditional edge requirements
- **"Whether perspectives should be generated synchronously on workspace completion or queued asynchronously"**
  - Suggestion: Consider engine performance ‚Äî async queue with mino batch processing likely better
- **"Scope boundary between mia-code-server rispecs and ava-langgraphjs ‚Äî where does orchestration live?"**
  - Suggestion: Clarify: mia-code-server defines the spec/interface, ava-langgraphjs implements the runtime

## Expected Outputs

### Artifacts
- rispecs/mia-server-core/12-session-chronicle-integration.spec.md
- rispecs/pde-engine/06-langgraph-agent-orchestration.spec.md
- src/node/mia/workspace-lifecycle/chronicle-emitter.ts
- src/node/mia/workspace-lifecycle/perspective-generator.ts
- src/node/mia/workspace-lifecycle/session-resume-loader.ts

### Updates
- src/node/mia/workspace-lifecycle/engine.ts ‚Äî add chronicle emission hooks
- src/node/mia/workspace-lifecycle/types.ts ‚Äî add ChronicleConfig, AgentSession types
- rispecs/README.md ‚Äî add new rispecs to index

### Communications
- GitHub issue linking mino integration to workspace lifecycle (miadisabelle/mia-code-server)
- GitHub issue for PDE‚ÜíLangGraph compiler design (miadisabelle/mia-code-server)
- Cross-reference to ava-langgraphjs for supervisor architecture alignment
